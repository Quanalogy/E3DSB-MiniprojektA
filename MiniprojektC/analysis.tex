% !TEX root = main.tex

\section{Analysis}
\label{sec:analysis}
The following analysis will be presented in two parts, one which will be before filtering with time domain response of the two signals and then the frequency analysis of these with poles and zeroes. Next an appropriate filter will be applied and the two signals will again be analysed as previously explained.

\subsection{Before filtering}

\subsubsection{Time domain analysis}

First a formal analysis of the man and the woman's voice saying "Hej Lasse" in the time domain. In \cref{fig:time_man} the signal for the man can be seen, with the time in seconds on the x-axis and the magnitude on the y-axis and similarily the womans signal is shown in \cref{fig:time_woman}.

\begin{figure}[h]
	\centering
	\begin{subfigure}{0.45\textwidth}
		\includegraphics[width=\textwidth]{OrgTid_Man.pdf}
		\caption{The time domain signal of the man.}
		\label{fig:time_man}
	\end{subfigure}
	\quad
	\begin{subfigure}{0.45\textwidth}
		\includegraphics[width=\textwidth]{OrgTid_Woman.pdf}
		\caption{The time domain signal of the woman.}
		\label{fig:time_woman}
	\end{subfigure}
	\caption{The time samples of a man and a woman saying "Hej Lasse".}
	\label{fig:time_WoMan}
\end{figure}

\subsubsection{Fourier transform with FFT}

The fourier transform will show the characteristics of the male and female voice. In \cref{fig:WoManFFT} the fourier transform based of the two previous signals seen in \cref{fig:time_WoMan} - in red the male signal and in blue the female signal. It is clear to see that the primary part of the voice of the male is located at lower frequencies than the voice of the woman.

\begin{figure}[h]
	\centering
	\includegraphics[width=\textwidth]{OrgFreq_WoMan.pdf}
	\caption{The frequency analysis of the man and woman.}
	\label{fig:WoManFFT}
\end{figure}

\subsection{Filtering}

\subsubsection{Highpass filter}
Next up is filtering the signal, which will be done with a highpass filter. From \cref{fig:WoManFFT} a cutoff estimation of \SI{3500}{\hertz} for the female voice and \SI{2800}{\hertz} for the male voice has been chosen. These two cutoff frequencies will be switched for the two signals to see which effect this will have on the signals.

The highpass filter is implemented as a function in matlab and can be seen in the following code example:

\begin{minted}{matlab}
function [figfreq, figHz] = HP(cutFreq, Fs, y, figOrgFreq, figfreqz)
N = length(y);
frequency_samples = [0:Fs/N:(Fs-(Fs/N))];
HighPass = cutFreq/(Fs/2);
HiPass = fir1(70,HighPass,'high');
figfreq = figure(figfreqz);
hold off
title('Filter characteristics');
hold on
freqz(HiPass,1);

% save and visualise 
tic
yHP = filter(HiPass,1,y);
toc
name = ['HP_', num2str(cutFreq), '_Hz.flac'];
audiowrite(name, yHP, Fs);
YHP = fft(yHP);
YdBHP = 20*log10(abs(YHP));

% Plot of discrete fourier transform
figHz = figure(figOrgFreq);
hold off
title(['Original and HP(512 Hz)', ' in frequency domain(FFT)']);
hold on
semilogx(frequency_samples(1:N/2), YdBHP(1:N/2), 'b');
legend({'original', 'highpass'}, 'FontSize', 16);
legend('Location','best');
end
\end{minted}

Notice that the filtered signal is stored as a .flac file, which also will be displayed. The filtered signal can be seen in \cref{fig:HPMAle} for the male and female in \cref{fig:HPFemale}. The filtered signals are somewhat disappointing to listen to, because it simply sounds like \fixme{Like what? hvorfor konklusion her?}

\begin{figure}[h]
	\centering
	\includegraphics[width=\textwidth]{HPnormFreq_Man.pdf}
	\caption{The highpass filtered signal of the male input.}
	\label{fig:HPMAle}
\end{figure}

\begin{figure}[h]
	\centering
	\includegraphics[width=\textwidth]{HPnormFreq_Woman.pdf}
	\caption{The highpass filtered signal of the female input.}
	\label{fig:HPFemale}
\end{figure}

\subsubsection{Bandpass filter}
\label{sec:Bandpass}
In the previous section a highpass filter were applied to test which effect it had on the two voices. Now a bandpass filter will be applied to the two voices to see which differences there will be. The start of the bandpass filter will again be \SI{2800}{\hertz} for the female signal and \SI{3500}{\hertz} for the male signal, while the cutoffs will be at \SI{8000}{\hertz} for the male signal and \SI{6500}{\hertz} for the female signal. The male filtered signal can be seen in \cref{fig:maleBP} and the female can be seen in \cref{fig:femaleBP}

The code for the bandpass filter is once again implemented in a function and the implementation is as follows:

\begin{minted}{matlab}
function [figW, figHz] = BP(freqRange, Fs, y, figOrgFreq)
N = length(y);
frequency_samples = [0:Fs/N:(Fs-(Fs/N))];
BandPass = freqRange/(Fs/2)
BPass = fir1(100,BandPass,'bandpass');%, kaiser(51,0.5));
figW = figure;
hold on
title('Filter characteristics');
freqz(BPass,1);

% Gem og visualiser frekvens√¶ndringen
tic
yBP = filter(BPass,1,y);
toc
name = ['BP_', num2str(freqRange(1)), '_Hz_to_', num2str(freqRange(2)), '_Hz.mp4'];
%audiowrite(name, yBP, Fs);
YBP = fft(yBP);
YdBBP= 20*log10(abs(YBP));

% Plot of discrete fourier transform
figHz = figure(figOrgFreq);
hold off
title({['Original and Bandpass'], [num2str(freqRange(1)), ' Hz to ',...
	num2str(freqRange(2)), ' Hz in frequency domain(FFT)']});
hold on
semilogx(frequency_samples(1:N/2), YdBBP(1:N/2), 'b');
legend({'original', 'bandpass'}, 'FontSize', 16);
legend('Location','best');
end
\end{minted}

\begin{figure}[h]
	\centering
	\includegraphics[width=\textwidth]{BP1normFreq_Man.pdf}
	\caption{Bandpass from \SI{3500}{\hertz} to \SI{8000}{\hertz} to the male signal.}
	\label{fig:maleBP}
\end{figure}

\begin{figure}[h]
	\centering
	\includegraphics[width=\textwidth]{BP1normFreq_Woman.pdf}
	\caption{Bandpass from \SI{2800}{\hertz} to \SI{6500}{\hertz} to the female signal.}
	\label{fig:femaleBP}
\end{figure}

\subsubsection{Magnitude and phase effect of filtering}
From the section "\nameref{sec:Bandpass}" the frequency response of the filters are analyzed with the function freqz from matlab. In \cref{fig:freqzMaleBP} the effects of phase and magnitude are shown, while on \cref{fig:freqzFemaleBP} the female response is shown.

\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{BandpassFreqz_male.pdf}
	\caption{freqz of the male signal after bandpass.}
	\label{fig:freqzMaleBP}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{BandpassFreqz_female.pdf}
	\caption{freqz of the female signal after bandpass.}
	\label{fig:freqzFemaleBP}
\end{figure}

\fxnote{Do they look alike? What does the figures show?}